<main>
  <section class="container d-flex flex-column align-items-center pt-5 gap-5">
    <h1 class="title">Episódios de<span>Rick e Morty</span></h1>

    <picture class="picture border border-4 border-dark border-bottom-0">
      <source srcset="images/dashboard-rick-and-morty.jpg" type="image/svg+xml" />
      <img src="images/dashboard-rick-and-morty.jpg" alt="Imagem do Rick e Morty" />
    </picture>
  </section>

  <section class="bg-dark py-4">
    <div class="container">
      <div class="row mb-3">
        <div class="col-12 col-md-6 ms-auto">
          <input
            class="form-control"
            type="search"
            placeholder="Pesquisar episódio..."
            [value]="(searchTerm$ | async) ?? ''"
            (input)="onSearch($any($event.target).value)"
          />
        </div>
      </div>
      <div class="row">
        <div class="table-responsive">
          <table class="table table-striped table-borderless">
            <thead class="table-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Nome</th>
                <th scope="col">Data de Lançamento</th>
                <th scope="col">Aparição</th>
                <th scope="col">Ações</th>
              </tr>
            </thead>
            <tbody>
              @for(episode of episodes$ | async; track episode.id){
              <tr>
                <th scope="row">{{ episode.id }}</th>
                <td>{{ episode.name }}</td>
                <td>{{ episode.air_date | date : 'mediumDate' }}</td>
                <td>{{ episode.episode | episodeFormat }}</td>
                <td>
                  <a [routerLink]="['/episodes', episode.id]" class="btn btn-primary btn-sm"
                    >Detalhes</a
                  >
                </td>
              </tr>
              } @if(loading$ | async){
              <tr>
                <td colspan="4" [class.table-loading]="isFirstLoad$ | async" class="text-center">
                  Carregando...
                </td>
              </tr>
              } @else if((episodes$ | async)?.length === 0){
              <tr>
                <td colspan="4" class="text-center">Nenhum episódio encontrado.</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <div #infiniteAnchor style="height: 1px"></div>
    </div>
  </section>
</main>
